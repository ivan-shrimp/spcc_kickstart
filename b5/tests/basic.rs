#![cfg(not(miri))]

test_run_bin::initialize!();

const GOOD: &str = "1\n";
const BAD: &str = "0\n";

#[test]
fn samples() {
    let input_1 = "8 8
58167243
79284365
36459178
43895721
25618497
17932684
84521936
91376852";

    let input_2 = "9 9
581672439
792843651
364591782
4389x7216
256184973
179326845
845219367
913768524
627435198";

    let input_3 = "9 9
111111111
111111111
111111111
111111111
111111111
111111111
111111111
111111111
111111111";

    let input_4 = "9 9
581672439
792843651
364591782
438957216
256184973
179326845
845219367
913768524
627435198";

    run(input_1, BAD);
    run(input_2, BAD);
    run(input_3, BAD);
    run(input_4, GOOD);
}

#[test]
fn missing_row_column() {
    let missing_row = "9 8
581672439
792843651
364591782
438957216
256184973
179326845
845219367
913768524";

    let missing_column = "8 9
58167243
79284365
36459178
43895721
25618497
17932684
84521936
91376852
62743519";

    run(missing_row, BAD);
    run(missing_column, BAD);
}

#[test]
fn extra_row_column() {
    let extra_row = "9 10
581672439
792843651
364591782
438957216
256184973
179326845
845219367
913768524
627435198
123456789";

    let extra_column = "10 9
5816724391
7928436512
3645917823
4389572164
2561849735
1793268456
8452193677
9137685248
6274351989";

    let many_extra_rows = String::from(
        "9 90
581672439
792843651
364591782
438957216
256184973
179326845
845219367
913768524
627435198",
    ) + &"123456789\n".repeat(9);

    run(extra_row, BAD);
    run(extra_column, BAD);
    run(&many_extra_rows, BAD);
}

#[test]
fn invalid_chars() {
    let zeroed = "9 9
581672430
702843651
364501782
438057216
256184073
170326845
845210367
013768524
627435108";

    let single_zero = "9 9
581672430
792843651
364591782
438957216
256184973
179326845
845219367
913768524
627435198";

    run(zeroed, BAD);
    run(single_zero, BAD);
}

#[test]
fn invalid_grids() {
    let invalid = "9 9
123456789
234567891
345678912
456789123
567891234
678912345
789123456
891234567
912345678";

    run(invalid, BAD);
}

#[test]
fn invalid_rows() {
    let invalid = "9 9
723456789
156789123
489123456
234567891
567891234
891234567
345678912
678912345
912345678";

    run(invalid, BAD);
}

#[test]
fn invalid_columns() {
    let invalid = "9 9
312456789
456789123
789123456
234567891
567891234
891234567
345678912
678912345
912345678";

    run(invalid, BAD);
}

#[test]
fn correct() {
    let correct = "9 9
123456789
456789123
789123456
234567891
567891234
891234567
345678912
678912345
912345678";

    run(correct, GOOD);
}
